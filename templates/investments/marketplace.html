{% extends 'investments/base_investment.html' %}
{% load investment_filters %}

{% block title %}Investment Marketplace - Meridian Asset Logistics{% endblock %}

{% block investment_content %}
<div class="px-4 sm:px-6 lg:px-8">
    <!-- Hero Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
            Investment Marketplace
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
            Discover premium investment opportunities in gold, real estate, precious metals, diamonds, art, and more. 
            Invest for growth or choose delivery - the choice is yours.
        </p>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Search -->
            <div class="md:col-span-2">
                <input type="text" 
                       id="search-input"
                       placeholder="Search investments..." 
                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
            </div>
            
            <!-- Category Filter -->
            <div>
                <select id="category-filter" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Sort -->
            <div>
                <select id="sort-filter" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    <option value="-is_featured">Featured First</option>
                    <option value="price_low">Price: Low to High</option>
                    <option value="price_high">Price: High to Low</option>
                    <option value="change_high">Best Performers</option>
                    <option value="change_low">Worst Performers</option>
                    <option value="-created_at">Newest First</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Featured Items -->
    {% if featured_items %}
    <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Featured Investments</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in featured_items %}
            <div class="investment-card bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden">
                {% if item.main_image %}
                    <img src="{{ item.main_image.url }}" alt="{{ item.name }}" class="w-full h-48 object-cover">
                {% else %}
                    <div class="w-full h-48 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-4xl"></i>
                    </div>
                {% endif %}
                
                <div class="p-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400">{{ item.category.name }}</span>
                        <span class="investment-type-badge investment-type-{{ item.investment_type|default:'both' }}">
                            {{ item.get_investment_type_display }}
                        </span>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{{ item.name }}</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">{{ item.short_description|default:item.description|truncatewords:15 }}</p>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white">
                                ${{ item.current_price_usd }}
                            </div>
                            <div class="text-sm {{ item.price_change_24h|get_price_change_class }}">
                                {{ item.price_change_24h|get_price_change_display }}
                                ({{ item.price_change_percentage_24h|get_percentage_change_display }})
                            </div>
                        </div>
                        
                        {% if item.weight %}
                        <div class="text-right text-sm text-gray-500 dark:text-gray-400">
                            <div>{{ item.weight }} oz</div>
                            {% if item.purity %}<div>{{ item.purity }}</div>{% endif %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="flex space-x-2">
                        {% if item.is_available_for_investment %}
                        <button onclick="investInItem({{ item.id }}, 'hold')" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Invest
                        </button>
                        {% endif %}
                        
                        {% if item.is_available_for_delivery %}
                        <button onclick="investInItem({{ item.id }}, 'delivery')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Buy & Deliver
                        </button>
                        {% endif %}
                        
                        <a href="{% url 'investments:investment-item-detail' item.id %}" 
                           class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Details
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Trending Items -->
    {% if trending_items %}
    <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Trending Now</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in trending_items %}
            <div class="investment-card bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden border-l-4 border-orange-500">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400">{{ item.category.name }}</span>
                        <span class="text-sm font-medium text-orange-600">ðŸ”¥ Trending</span>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{{ item.name }}</h3>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white">
                                ${{ item.current_price_usd }}
                            </div>
                            <div class="text-sm {{ item.price_change_24h|get_price_change_class }}">
                                {{ item.price_change_24h|get_price_change_display }}
                                ({{ item.price_change_percentage_24h|get_percentage_change_display }})
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        {% if item.is_available_for_investment %}
                        <button onclick="investInItem({{ item.id }}, 'hold')" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Invest
                        </button>
                        {% endif %}
                        
                        <a href="{% url 'investments:investment-item-detail' item.id %}" 
                           class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Details
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- All Items -->
    <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">All Investments</h2>
        <div id="items-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Items will be loaded here dynamically -->
        </div>
        
        <div id="loading" class="text-center py-8 hidden">
            <div class="inline-flex items-center">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading investments...
            </div>
        </div>
        
        <div id="no-items" class="text-center py-8 hidden">
            <p class="text-gray-500 dark:text-gray-400">No investments found matching your criteria.</p>
        </div>
    </div>
</div>

<!-- Investment Modal -->
<div id="investment-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3">
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Make Investment</h3>
            
            <div id="modal-content">
                <!-- Modal content will be loaded here -->
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeInvestmentModal()" 
                        class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500">
                    Cancel
                </button>
                <button id="confirm-investment" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 hidden">
                    Confirm Investment
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let currentFilters = {
        search: '',
        category: '',
        sort: '-is_featured'
    };
    
    let allItems = [];
    
    // Load items on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadItems();
        
        // Set up event listeners
        document.getElementById('search-input').addEventListener('input', debounce(handleSearch, 300));
        document.getElementById('category-filter').addEventListener('change', handleFilterChange);
        document.getElementById('sort-filter').addEventListener('change', handleFilterChange);
    });
    
    function loadItems() {
        const loading = document.getElementById('loading');
        const itemsContainer = document.getElementById('items-container');
        const noItems = document.getElementById('no-items');
        
        loading.classList.remove('hidden');
        itemsContainer.innerHTML = '';
        noItems.classList.add('hidden');
        
        // Build query string
        const params = new URLSearchParams();
        if (currentFilters.search) params.append('search', currentFilters.search);
        if (currentFilters.category) params.append('category', currentFilters.category);
        if (currentFilters.sort) params.append('sort', currentFilters.sort);
        
        fetch(`/investments/api/items/?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                loading.classList.add('hidden');
                allItems = data.results || data;
                
                if (allItems.length === 0) {
                    noItems.classList.remove('hidden');
                } else {
                    renderItems(allItems);
                }
            })
            .catch(error => {
                console.error('Error loading items:', error);
                loading.classList.add('hidden');
                noItems.classList.remove('hidden');
            });
    }
    
    function renderItems(items) {
        const container = document.getElementById('items-container');
        container.innerHTML = '';
        
        items.forEach(item => {
            const itemElement = createItemElement(item);
            container.appendChild(itemElement);
        });
    }
    
    function createItemElement(item) {
        const div = document.createElement('div');
        div.className = 'investment-card bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden';
        
        const priceChangeClass = getPriceChangeClass(item.price_change_24h);
        const priceChangeDisplay = item.price_change_24h > 0 ? 
            `+$${item.price_change_24h}` : 
            `-$${Math.abs(item.price_change_24h)}`;
        const percentageDisplay = item.price_change_percentage_24h > 0 ? 
            `+${item.price_change_percentage_24h}%` : 
            `-${Math.abs(item.price_change_percentage_24h)}%`;
        
        div.innerHTML = `
            <div class="p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-500 dark:text-gray-400">${item.category.name}</span>
                    <span class="investment-type-badge investment-type-${item.investment_type}">
                        ${item.investment_type === 'investment_only' ? 'Investment Only' : 
                          item.investment_type === 'delivery_only' ? 'Delivery Only' : 'Investment & Delivery'}
                    </span>
                </div>
                
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">${item.name}</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">${item.short_description || item.description.substring(0, 100)}...</p>
                
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="text-2xl font-bold text-gray-900 dark:text-white">
                            $${item.current_price_usd}
                        </div>
                        <div class="text-sm ${priceChangeClass}">
                            ${priceChangeDisplay} (${percentageDisplay})
                        </div>
                    </div>
                    
                    ${item.weight ? `
                    <div class="text-right text-sm text-gray-500 dark:text-gray-400">
                        <div>${item.weight} oz</div>
                        ${item.purity ? `<div>${item.purity}</div>` : ''}
                    </div>
                    ` : ''}
                </div>
                
                <div class="flex space-x-2">
                    ${item.is_available_for_investment ? `
                    <button onclick="investInItem(${item.id}, 'hold')" 
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Invest
                    </button>
                    ` : ''}
                    
                    ${item.is_available_for_delivery ? `
                    <button onclick="investInItem(${item.id}, 'delivery')" 
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Buy & Deliver
                    </button>
                    ` : ''}
                    
                    <a href="/investments/item/${item.id}/" 
                       class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Details
                    </a>
                </div>
            </div>
        `;
        
        return div;
    }
    
    function handleSearch(event) {
        currentFilters.search = event.target.value;
        loadItems();
    }
    
    function handleFilterChange(event) {
        const field = event.target.id.replace('-filter', '');
        currentFilters[field] = event.target.value;
        loadItems();
    }
    
    function investInItem(itemId, investmentType) {
        if (!isAuthenticated()) {
            window.location.href = '/accounts/login/?next=' + encodeURIComponent(window.location.pathname);
            return;
        }
        
        // Find the item
        const item = allItems.find(i => i.id === itemId);
        if (!item) return;
        
        showInvestmentModal(item, investmentType);
    }
    
    function showInvestmentModal(item, investmentType) {
        const modal = document.getElementById('investment-modal');
        const modalContent = document.getElementById('modal-content');
        const confirmButton = document.getElementById('confirm-investment');
        
        const typeText = investmentType === 'hold' ? 'Investment' : 'Buy & Deliver';
        const minAmount = item.minimum_investment;
        const maxAmount = item.maximum_investment || 'No limit';
        
        modalContent.innerHTML = `
            <div class="mb-4">
                <h4 class="font-medium text-gray-900 dark:text-white">${item.name}</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400">${typeText}</p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Investment Amount (USD)
                </label>
                <input type="number" 
                       id="investment-amount" 
                       min="${minAmount}" 
                       ${maxAmount !== 'No limit' ? `max="${maxAmount}"` : ''}
                       step="0.01" 
                       value="${minAmount}"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    Min: $${minAmount} ${maxAmount !== 'No limit' ? `| Max: $${maxAmount}` : ''}
                </p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Quantity
                </label>
                <input type="number" 
                       id="investment-quantity" 
                       min="0.000001" 
                       step="0.000001" 
                       readonly
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 dark:text-white">
            </div>
            
            <div class="text-sm text-gray-600 dark:text-gray-400">
                <p>Current Price: $${item.current_price_usd}</p>
                <p>24h Change: <span class="${getPriceChangeClass(item.price_change_24h)}">${item.price_change_24h > 0 ? '+' : ''}$${item.price_change_24h}</span></p>
            </div>
        `;
        
        // Calculate quantity when amount changes
        const amountInput = document.getElementById('investment-amount');
        const quantityInput = document.getElementById('investment-quantity');
        
        amountInput.addEventListener('input', function() {
            const amount = parseFloat(this.value) || 0;
            const quantity = amount / item.current_price_usd;
            quantityInput.value = quantity.toFixed(6);
        });
        
        // Initial calculation
        quantityInput.value = (minAmount / item.current_price_usd).toFixed(6);
        
        confirmButton.classList.remove('hidden');
        confirmButton.onclick = () => confirmInvestment(item.id, investmentType);
        
        modal.classList.remove('hidden');
    }
    
    function closeInvestmentModal() {
        document.getElementById('investment-modal').classList.add('hidden');
    }
    
    function confirmInvestment(itemId, investmentType) {
        const amount = parseFloat(document.getElementById('investment-amount').value);
        const quantity = parseFloat(document.getElementById('investment-quantity').value);
        
        if (!amount || amount <= 0) {
            alert('Please enter a valid investment amount');
            return;
        }
        
        // Create investment transaction
        const transactionData = {
            item: itemId,
            transaction_type: 'purchase',
            amount_usd: amount,
            investment_type: investmentType,
            description: `${investmentType === 'hold' ? 'Investment' : 'Buy & Deliver'}: ${amount} USD`
        };
        
        fetch('/investments/api/transactions/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(transactionData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.payment_url) {
                closeInvestmentModal();
                // Redirect to payment
                window.location.href = data.payment_url;
            } else {
                alert('Failed to create investment: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error creating investment:', error);
            alert('Failed to create investment. Please try again.');
        });
    }
    
    function isAuthenticated() {
        return document.body.classList.contains('user-authenticated') || 
               document.querySelector('[data-user-id]') !== null;
    }
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Filter and search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const sortFilter = document.getElementById('sort-filter');
        const itemsContainer = document.getElementById('items-container');
        const loadingDiv = document.getElementById('loading');
        const noItemsDiv = document.getElementById('no-items');
        
        // Load initial items
        loadItems();
        
        // Add event listeners for filtering
        searchInput.addEventListener('input', debounce(loadItems, 300));
        categoryFilter.addEventListener('change', loadItems);
        sortFilter.addEventListener('change', loadItems);
        
        function loadItems() {
            const search = searchInput.value;
            const category = categoryFilter.value;
            const sort = sortFilter.value;
            
            // Show loading
            loadingDiv.classList.remove('hidden');
            noItemsDiv.classList.add('hidden');
            itemsContainer.innerHTML = '';
            
            // Build query parameters
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (category) params.append('category', category);
            if (sort) params.append('sort', sort);
            
            // Fetch items from API
            fetch(`/investments/api/items/?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    loadingDiv.classList.add('hidden');
                    
                    if (data.results && data.results.length > 0) {
                        displayItems(data.results);
                    } else {
                        noItemsDiv.classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error loading items:', error);
                    loadingDiv.classList.add('hidden');
                    noItemsDiv.classList.remove('hidden');
                });
        }
        
        function displayItems(items) {
            itemsContainer.innerHTML = '';
            
            items.forEach(item => {
                const itemCard = createItemCard(item);
                itemsContainer.appendChild(itemCard);
            });
        }
        
        function createItemCard(item) {
            const card = document.createElement('div');
            card.className = 'investment-card bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden';
            
            const priceChangeClass = item.price_change_24h > 0 ? 'text-green-600 dark:text-green-400' : 
                                   item.price_change_24h < 0 ? 'text-red-600 dark:text-red-400' : 
                                   'text-gray-600 dark:text-gray-400';
            
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400">${item.category_name}</span>
                        <span class="investment-type-badge investment-type-${item.investment_type}">
                            ${item.investment_type === 'investment_only' ? 'Investment Only' : 
                              item.investment_type === 'delivery_only' ? 'Delivery Only' : 'Investment & Delivery'}
                        </span>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">${item.name}</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">${item.short_description || item.description}</p>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white">
                                $${item.current_price_usd}
                            </div>
                            <div class="text-sm ${priceChangeClass}">
                                ${item.price_change_24h > 0 ? '+' : ''}$${item.price_change_24h}
                                (${item.price_change_percentage_24h > 0 ? '+' : ''}${item.price_change_percentage_24h}%)
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        ${item.is_available_for_investment ? `
                            <button onclick="investInItem(${item.id}, 'hold')" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Invest
                            </button>
                        ` : ''}
                        
                        ${item.is_available_for_delivery ? `
                            <button onclick="investInItem(${item.id}, 'delivery')" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Buy & Deliver
                            </button>
                        ` : ''}
                        
                        <a href="/investments/item/${item.id}/" 
                           class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Details
                        </a>
                    </div>
                </div>
            `;
            
            return card;
        }
    });
</script>
{% endblock %}
